@using System.Globalization
@using Spectre.Console
@namespace RazorConsole.Components

<div @onfocus="OnFocus" @onfocusout="OnFocusOut" @onclick="OnClick"
     data-focusable="true"
     data-focus-order="@FocusOrderAttribute"
     @key="@_generatedFocusKey"
     data-focus-key="@_generatedFocusKey">
    <Markup Content="@Content" Background="@(_isFocused ? FocusedColor : BackgroundColor)"/>
</div>

@code {

    /// <summary>
    /// Clickable button with text that changes appearance when focused.
    /// </summary>
    /// <remarks>
    /// Simple button implementation with focus and click support. Background color changes on focus for visual feedback.
    /// </remarks>
    private bool _isFocused = false;

    private readonly string _generatedFocusKey = Guid.NewGuid().ToString("N");

    /// <summary>
    /// Background color when focused. Default is <see cref="Color.DeepSkyBlue1"/>.
    /// </summary>
    [Parameter]
    public Spectre.Console.Color FocusedColor { get; set; } = Spectre.Console.Color.DeepSkyBlue1;

    /// <summary>
    /// Background color when not focused. Default is <see cref="Spectre.Console.Color.Default"/>.
    /// </summary>
    [Parameter]
    public Spectre.Console.Color BackgroundColor { get; set; } = Spectre.Console.Color.Default;

    /// <summary>
    /// Text content displayed on the button.
    /// </summary>
    [Parameter]
    public string Content { get; set; } = string.Empty;

    /// <summary>
    /// Event callback invoked when the button is clicked.
    /// </summary>
    [Parameter]
    public EventCallback OnClick { get; set; }

    /// <summary>
    /// Tab order for keyboard navigation. Lower values receive focus first. If <c>null</c>, natural document order is used.
    /// </summary>
    [Parameter]
    public int? FocusOrder { get; set; }

    private string? FocusOrderAttribute => FocusOrder.HasValue
        ? FocusOrder.Value.ToString(CultureInfo.InvariantCulture)
        : null;

    private void OnFocus(FocusEventArgs e)
    {
        _isFocused = true;
        StateHasChanged();
    }

    private void OnFocusOut(FocusEventArgs e)
    {
        _isFocused = false;
        StateHasChanged();
    }
}
