@using Spectre.Console
@namespace RazorConsole.Components

<stepchart data-width="@Width"
           data-height="@Height"
           data-show-axes="@ShowAxes.ToString().ToLower()"
           data-axes-color="@AxesColorAttribute"
           data-labels-color="@LabelsColorAttribute"
           data-title="@TitleAttribute"
           data-title-color="@TitleColorAttribute">
    @foreach (var series in Series)
    {
        <chartseries data-color="@series.Color.ToHex()" data-points="@SerializePoints(series.Points)"/>
    }
</stepchart>

@code {
    [Parameter]
    public int Width { get; set; } = 60;

    [Parameter]
    public int Height { get; set; } = 20;

    [Parameter]
    public bool ShowAxes { get; set; } = true;

    [Parameter]
    public Color AxesColor { get; set; } = Color.Gray;

    [Parameter]
    public Color LabelsColor { get; set; } = Color.Gray;

    [Parameter]
    public string? Title { get; set; }

    [Parameter]
    public Color TitleColor { get; set; } = Color.Gray;

    [Parameter]
    public List<ChartSeries> Series { get; set; } = new();

    private string SerializePoints(IEnumerable<(double X, double Y)> points)
        => string.Join(";", points.Select(p => $"{p.X},{p.Y}"));

    private string AxesColorAttribute => AxesColor.ToHex();

    private string LabelsColorAttribute => LabelsColor.ToHex();

    private string TitleAttribute => Title ?? string.Empty;

    private string TitleColorAttribute => TitleColor.ToHex();


    public record ChartSeries(Color Color, List<(double X, double Y)> Points);
}
