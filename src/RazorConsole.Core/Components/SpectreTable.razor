@namespace RazorConsole.Components

@using System.Collections.Generic
@using System.Globalization
@using Microsoft.AspNetCore.Components
@using Spectre.Console

<table class="table"
	data-expand="@ExpandAttribute"
	data-width="@WidthAttribute"
	data-title="@TitleAttribute"
    data-border="@BorderAttribute"
    data-border-color="@BorderColorAttribute"
	data-show-headers="@ShowHeadersAttribute"
	@attributes="AdditionalAttributes">
    @ChildContent
</table>

@code {
    /// <summary>
    /// Renders a formatted table using Spectre.Console's <see cref="global::Spectre.Console.Table"/> renderable.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Creates structured tabular data displays with rows, columns, headers, and borders.
    /// Use with nested <see cref="SpectreTHead"/>, <see cref="SpectreTBody"/>, <see cref="SpectreTFoot"/>,
    /// <see cref="SpectreTR"/>, <see cref="SpectreTH"/>, and <see cref="SpectreTD"/> components.
    /// </para>
    /// <para>
    /// See the <see href="https://spectreconsole.net/widgets/table">Spectre.Console Table documentation</see> for more information.
    /// </para>
    /// </remarks>

    /// <summary>
    /// Content containing table rows and cells.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Whether the table should expand to fill available space. Default is <c>false</c>.
    /// </summary>
    [Parameter]
    public bool Expand { get; set; }

    /// <summary>
    /// Width of the table in characters. If <c>null</c> or less than 1, automatically determined by content.
    /// </summary>
    [Parameter]
    public int? Width { get; set; }

    /// <summary>
    /// Title displayed above the table. If <c>null</c> or empty, no title is shown.
    /// </summary>
    [Parameter]
    public string? Title { get; set; }

    /// <summary>
    /// Style of the table border. See <see cref="TableBorder"/> for available styles like <see cref="TableBorder.Rounded"/>, <see cref="TableBorder.Square"/>, and <see cref="TableBorder.Minimal"/>.
    /// </summary>
    [Parameter]
    public TableBorder? Border { get; set; }

    /// <summary>
    /// Color of the table border. Default is <see cref="Color.White"/>.
    /// </summary>
    [Parameter]
    public Color BorderColor { get; set; } = Color.White;

    /// <summary>
    /// Whether table headers should be displayed. Default is <c>true</c>.
    /// </summary>
    [Parameter]
    public bool ShowHeaders { get; set; } = true;

    /// <summary>
    /// Additional HTML attributes to apply to the table element.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public IReadOnlyDictionary<string, object?>? AdditionalAttributes { get; set; }

	private string ExpandAttribute => Expand ? "true" : "false";

	private string? WidthAttribute => Width.HasValue && Width.Value > 0
		? Width.Value.ToString(CultureInfo.InvariantCulture)
		: null;

	private string? TitleAttribute => string.IsNullOrWhiteSpace(Title) ? null : Title;

	private string? BorderAttribute => ToBorderAttribute(Border);

    private string BorderColorAttribute => BorderColor.ToHex();

	private static string? ToBorderAttribute(TableBorder? border)
	{
		if (border is null)
		{
			return null;
		}

		if (ReferenceEquals(border, TableBorder.Ascii))
		{
			return "ascii";
		}

		if (ReferenceEquals(border, TableBorder.Heavy))
		{
			return "heavy";
		}

		if (ReferenceEquals(border, TableBorder.Horizontal))
		{
			return "horizontal";
		}

		if (ReferenceEquals(border, TableBorder.Minimal))
		{
			return "minimal";
		}

		if (ReferenceEquals(border, TableBorder.MinimalDoubleHead))
		{
			return "minimaldoublehead";
		}

		if (ReferenceEquals(border, TableBorder.MinimalHeavyHead))
		{
			return "minimalheavyhead";
		}

		if (ReferenceEquals(border, TableBorder.Simple))
		{
			return "simple";
		}

		if (ReferenceEquals(border, TableBorder.SimpleHeavy))
		{
			return "simpleheavy";
		}

		if (ReferenceEquals(border, TableBorder.Square))
		{
			return "square";
		}

		if (ReferenceEquals(border, TableBorder.Double))
		{
			return "double";
		}

		if (ReferenceEquals(border, TableBorder.Rounded))
		{
			return "rounded";
		}

		if (ReferenceEquals(border, TableBorder.None))
		{
			return "none";
		}

		return null;
	}

	private string ShowHeadersAttribute => ShowHeaders ? "true" : "false";
}
